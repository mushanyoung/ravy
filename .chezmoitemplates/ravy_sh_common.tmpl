{{- /* Common bash/zsh env + PATH setup. */ -}}

# --- PATH helpers -------------------------------------------------------------
_ravy_prepend_path() {
  # Usage: _ravy_prepend_path /some/dir
  [ -n "${1:-}" ] || return 0
  [ -d "$1" ] || return 0
  case ":$PATH:" in
    *":$1:"*) : ;;
    *) PATH="$1:$PATH" ;;
  esac
}

# User scripts (managed by chezmoi as ~/bin/* and ~/.local/bin/*)
_ravy_prepend_path "$HOME/bin"
_ravy_prepend_path "$HOME/.local/bin"

# Homebrew / Linuxbrew detection (sets env + updates PATH/MANPATH/INFOPATH)
if [ -z "${RAVY_SKIP_BREW:-}" ]; then
  for brewprefix in /opt/homebrew /usr/local /home/linuxbrew/.linuxbrew "$HOME/.brew" "$HOME/.linuxbrew"; do
    if [ -x "$brewprefix/bin/brew" ]; then
      HOMEBREW_PREFIX="$brewprefix"
      HOMEBREW_CELLAR="$brewprefix/Cellar"
      HOMEBREW_REPOSITORY="$brewprefix/Homebrew"
      HOMEBREW_NO_ANALYTICS=1
      export HOMEBREW_PREFIX HOMEBREW_CELLAR HOMEBREW_REPOSITORY HOMEBREW_NO_ANALYTICS

      if [ -d "$HOMEBREW_PREFIX/share/man" ]; then
        MANPATH="${MANPATH:-}"
        export MANPATH="$HOMEBREW_PREFIX/share/man${MANPATH:+:$MANPATH}"
      fi
      if [ -d "$HOMEBREW_PREFIX/share/info" ]; then
        INFOPATH="${INFOPATH:-}"
        export INFOPATH="$HOMEBREW_PREFIX/share/info${INFOPATH:+:$INFOPATH}"
      fi

      if [ -d "$brewprefix/opt/ruby/bin" ]; then
        _ravy_prepend_path "$brewprefix/opt/ruby/bin"
      fi

      _ravy_prepend_path "$HOMEBREW_PREFIX/sbin"
      _ravy_prepend_path "$HOMEBREW_PREFIX/bin"
      break
    fi
  done
fi

export PATH

# --- Environment --------------------------------------------------------------
export LANG="en_US.UTF-8"
export LANGUAGE="$LANG"
export EDITOR="nvim"
export GIT_EDITOR="nvim"

# Avoid hanging in Cursor Agent terminal executions.
if [ -n "${CURSOR_AGENT:-}" ] || [ -n "${CURSOR_TRACE_ID:-}" ]; then
  export PAGER="cat"
  export MANPAGER="cat"
  export GIT_PAGER="cat"
else
  export PAGER="less"
  export MANPAGER="less"
  export GIT_PAGER="less"
fi

export LESS="FRSXMi"
export LESS_TERMCAP_mb="$(printf '\033[01;31m')"
export LESS_TERMCAP_md="$(printf '\033[01;38;5;74m')"
export LESS_TERMCAP_me="$(printf '\033[0m')"
export LESS_TERMCAP_so="$(printf '\033[7;40;33m')"
export LESS_TERMCAP_se="$(printf '\033[0m')"
export LESS_TERMCAP_us="$(printf '\033[04;38;5;178m')"
export LESS_TERMCAP_ue="$(printf '\033[0m')"

export FZF_DEFAULT_OPTS="--bind=ctrl-f:page-down,ctrl-b:page-up --layout=reverse --height=50% --border"
export FZF_DEFAULT_COMMAND="fd"

# Keep these consistent across shells
export EZA_CONFIG_DIR="$HOME/.config/eza"
export STARSHIP_CONFIG="$HOME/.config/starship.toml"

